// nextflow.config

process {
  resourceLimits = [
    cpus: 24,
    memory: 96.GB,
    time: 12.h
  ]
}

process {
    // Define the error strategy
    errorStrategy = 'retry'
    maxRetries    = 2
    maxErrors     = '-1'

    // General resource requirements
    queue         = 'low'
    cpus          = { 1 * task.attempt }
    memory        = { 8.GB * task.attempt }
    time          = { 4.h * task.attempt }

    // Process-specific resource requirements
    withLabel: process_single {
        queue  = 'low'
        cpus   = 1
        memory = { 8.GB * task.attempt }
        time   = { 4.h * task.attempt }
    }
    withLabel: process_low {
        queue  = 'low'
        cpus   = { 1 * task.attempt }
        memory = { 8.GB * task.attempt }
        time   = { 4.h * task.attempt }
    }
    withLabel: process_medium {
        queue  = 'low'
        cpus   = { 8 * task.attempt }
        memory = { 32.GB * task.attempt }
    }
}

executor {
    account           = 'band.prj'
    name              = 'slurm'
    queueStatInterval = '100 sec'
    pollInterval      = '10 sec'
}


params {
    // Reference and FASTQ file paths
    samplesheet = "path/to/samplesheet.csv"
    /*primary_contigs = [ 
        [
            [sample_id:"FUP_H-meg-r1-FV", reference:"/well/band/projects/pfsa/data/assemblies/Pf3D7_v3/Pf3D7_v3.fasta"],
             "/well/band/users/sqy262/assembly_pipeline/primary_contigs/FUP_H-meg-r1-FV.bp.p_ctg.gfa"
        ], 
        [
            [sample_id:"FUP_H-shk-r1-2x", reference:"/well/band/projects/pfsa/data/assemblies/Pf3D7_v3/Pf3D7_v3.fasta"],
            "/well/band/users/sqy262/assembly_pipeline/primary_contigs/FUP_H-shk-r1-2x.bp.p_ctg.gfa"
        ],
        [
            [sample_id:"FUP_H-shk-r1-FV", reference:"/well/band/projects/pfsa/data/assemblies/Pf3D7_v3/Pf3D7_v3.fasta"],
            "/well/band/users/sqy262/assembly_pipeline/primary_contigs/FUP_H-shk-r1-FV.bp.p_ctg.gfa"
        ]
    ]*/    
    outdir = "./"
    
    //dockerImage = 'ngs_pipeline' // Docker image name
}

process {
    withName: 'CREATE_BAM' {
        publishDir = [
            path: { "${params.outdir}/results/03_READS_ALIGNED" },
            mode: 'copy'
        ]
    }
    
    withName: 'CREATE_BAM_CONTIGS' {
        publishDir = [
            path: { "${params.outdir}/results/05_ORIENTED_CONTIGS_ALIGNED" },
            mode: 'copy'
        ]
    }
}


/* process {
     //Default process configuration
     withLabel: '.*' {
        container = params.dockerImage
    }
} */


